---
title: 'Lesson 1: Introduction to the geo-scripting course'
author: "Jan Verbesselt and Loïc Dutrieux"
output:
  html_document:
    theme: united
    toc: yes
    toc_depth: 4
    number_sections: true
  pdf_document:
    toc: yes
---

# Today's items

## ToDo in the morning

During the morning session read through this tutorial but focus on the code examples from Introduction to R onwards (See [Getting Started With R](#gettingstarted)).

## Objective of today:

A self-test for yourself you see if you have the necessary scripting skills to continue with the course.

## Learning outcomes of today:

- Refreshing R skills and possibilities
- Able to write a function
- Know how to visualise data (spatial map) in R

# Introduction to the Geo-scripting course

## Course concept
- The course is freshly developed based on needs from people who deal with spatial data
- It is a new course, there is a certain flexibility to adjust the content
- A team of R experts, Loic, Ben, Eliakim, Sytze, who use Geo-scripting languages every day helped to develop this course
- Feedback is welcome and we are there to help you the course
- Avoid copy paste, and make sure you understand all steps

We will show you how to find help
  - Try to solve the problem as independent as possible
	- Work together with fellow students but make sure you complete everything yourself

## Daily activities

- See course description

## Course planning and agenda

- See blackboard page for planning and course content

## Geo-scripting learning objectives

- Understand basic concepts of applied scripting for spatial data
- Use functions from a library while writing your script
- Find libraries which offer spatial data handling functions
- Know how to find help (on spatial data handling functions)
- Solve scripting problems (debug, reproducible example, writing functions)
- Read, write, and visualise spatial data (vector/raster) using a script
- Apply learned concepts in a case study with geo-data by solving a spatial/ecological/applied question 

## Why geo-scripting?

- Reproducible: avoid clicking and you keep track of what you have done
-	Efficient: you can write a script to do something for you e.g. multiple times e.g. automatically downloading data
-	Build your own tools and functions (e.g. raster filters, MODIS download tool, BFAST package)
-	Enable collaboration: sharing scripts, functions, and packages
-	Good for finding errors i.e. debugging

*examples of advantages of geo-scripting to be added here*
e.g. This course is fully written with scripting languages (i.e. R and MarkDown). What are the advantages?

## What  is a scripting language?

- A scripting language (e.g. R and Python) can interpret and automate the execution of tasks which could alternatively be executed one-by-one by a human operator
- Different from like C/C++/Fortran since these are languages that need to be compiled first.
- Compiling? Programmers write programs in a form called source code. Source code must go through several steps before it becomes an executable program. The first step is to pass the source code through a compiler, which translates the high-level language instructions into object code.

 ![Compiling a program)`](figs/compile.jpg)

- A scripting language is the glue, between different commands, functions, and objectives without the need to compile it for each OS/CPU Architecture

## Different scripting languages for geo-scripting

### The main scripting languages for GIS and Remote sensing currently are: 

- R
- Python
  - stand-alone (ArcPy and PyQGIS)
  - integrated within ArcGIS, QGIS 

- GRASS (grass function are included in QGIS)
- Javascript for geoweb scripting
- Matlab
- IDL (ENVI)
- JavaScript

### Python versus R

- Python is a general purpose programming language with a clear syntax
- R is particularly strong in statistical computing and graphics
- Installing libraries in Python is sometimes challenging
- Syntactic differences can be confusing (especially when combining these) 
- There are many R and Python packages for spatial analyses and for dealing with spatial data
- Scripts in both languages can be combined:
  - call R from Python using e.g. RPy, RPy2
  - call Python from R (http://rpython.r-forge.r-project.org/)

### Many programs have support for

- Python (Blender, Sketchup, QGIS, MySQL, PostGIS)
- R (GRASS, QGIS, MySQL, PostGIS)

# Getting started with R scripting {#gettingstarted}

## Online help and tutorial

This preliminary section will cover some basic details about R. For this course we will use Rstudio as an IDE to write and run scripts.

We will start with the first paragraph:
Learn the basics, and go to [Try R](http://tryr.codeschool.com/). This morning during this tutorial you need to complete the full 8 chapters of this R basics online course (you can sign in, and complete all chapters here). Upload the proof to blackboard that you have completed all chapters and challenges. Record the time you need to complete this online course and write down if you have questions. Send me, Jan Verbesselt, an e-mail with the information before 12 today (e.g. a screenshot or a Twitter tweet that you completed the course).

Once you have finished continue with the section below.

# Basic R and RStudio setup
## Getting started with Rstudio and R on your own computer.

A summary youtube movie about how to use Rstudio and writing a function is here: [Intro to Rstudio](https://www.youtube.com/watch?v=jPk6-3prknk). Have a look at this movie and then do the following section.
 
Now, Open Rstudio and type the following script in the R console of **Rstudio**:

```{r}
rm(list = ls())  # Clear the workspace!
ls() ## no objects left in the workspace
```

A good way to start most R scripts

```{r
a <- 1
a
```

The first line you passed to the console created a new object named  $a$ in memory.
The symbol '<-' is somewhat equivalent to an equal sign but recommended as it is used internally. In the second line you printed $a$ to the console by simply typing it's name.

**What is the class of this object?**

```{r
class(a)
```

You now have requested the class attribute of $a$ and the console has returned the attribute: numeric. R possesses a simple mechanism to support an object-oriented style of programming. All objects ($a$ in this case) have a class attribute assigned to them. R is quite forgiving and will assign a class to an object even if you haven't specified one (as you didn't in this case). Classes are a very important feature of the R environment. Any function or method that is applied to an object takes into account its class and uses this information to determine the correct course of action.

## Set Your Working Directory

Let's do some basic set up first.

- Create a folder which will be your working directory e.g. Lesson1
- Create an R script within that folder
- Set your working directory to the Lesson1 folder
- Create a $data$ folder within your working directory

In the code block below type in the file path to where your data is being held and then (if you want) use the setwd() (set working directory) command to give R a default location to look for data files.

```{r, eval=FALSE}
setwd("yourworkingdirectory")
# This sets the working directory (where R looks for files)
getwd() # Double check your working directory
datdir <- file.path("data") ## path
```

# Basic R knowledge usefull for Geo-Scripting
Scripting with R to handle spatial problems requires a core set of basic R skills. To prepare you well for the coming weeks, we've summarized what we think are important skills for geo scripting below. 

## Vector handling and vector arithmetic
You'll be introduced in a following lesson with the raster package and the raster classes that have been developped as part of that package. All objects that belong to the class `raster` are **vectors** with a few more spatial attributes. 

**In `R` we call a collection of number a vector.** 

As a consequence, handling vector is a crucial skill for processing raster data in R.

Reference manual for vector handling and vector arithmetic can be found [here](http://cran.r-project.org/doc/manuals/r-release/R-intro.html#Simple-manipulations-numbers-and-vectors).

```{r}
# Create a vector
a <- c(3,6,8,1)
a

# Any mathematical operation can be performed on vectors
(b <- a * 2)
(d <- a + 6)

# Two vectors of same length can also be added with each others
(e <- a + b)
```

Value replacement

```{r}
# Values in a vector that satisfy a certain condition can be replaced by other values
a <- c(2,5,2,5,6,9,2,12)

# Values inferior or equal to 5 are replaced by 0
a[a <= 5] <- 0
a

# Condition can be defined using another vector of equal length
a <- c(2,5,2,5,6,9,2,12)
b <- c(1,1,0,1,0,0,1,0)

# Change the values of a based on b values
a[b == 0] <- NA
a

# More complex value replacement
a <- c(2,5,2,5,6,9,2,12)
b <- c(1,1,2,1,0,0,1,2)
# a values at which b is equal to either 0 or 1 are replaced by NA
a[b %in% c(0,1)] <- NA
a
```

## Character vector handling

When working with *real* data, such as shapefiles or satellite imagery, the data always need to be read from files. File names and file paths define the location of a file on a computer hard drive. A great advantage of scripting is that locating data, reading and writing data can be fairly easily automated (generate automatic file names, recognise patterns in file names, etc). That requires from the user some basic **string** handling skills.

Key functions for handling character strings are listed below:

* `list.files()`: to list files in a directory
* `paste()`, `paste0()`, `sprintf()`: useful to combine vectors e.g. to create a filename
* `strsplit()`: to split up a string

<!---
* Loïc - I did not add this yet - as it requires just a touch more of an explanation - looking for a simple example linked with an application.
* `glob2rx()`:  Note: if you know regular expressions, you do not need that function. But most people are more comfortable working with wildcards.
-->

### Example of `list.files()`

```{r, eval=FALSE}
getwd() ## check your working directory
list.files() ## list the files available in this directory
```

**Question**: List the directories in your working directory

### Example of `paste()`

```{r}
## two handy examples
paste("Today is", date())
paste("A", 1:6, sep = "")
```

**Question**: create one variable containing a sentence, based on a, b, or c:

```{r, eval=FALSE}

"geo-scripting is fun" # by combining a, b, an c
a <- "geo-scripting"
b <- "is"
c <- "fun"

## what if you only have d, defined as a list?
d <- list(a, b, c)
paste(d) ## this is not good
```

### Example of `strsplit()`

```{r}
# I have the following character string
name <- 'today_is_friday_12-12-2014'

# I want to extract the date contained in it, I can split it based on the underscores and the fourth element should be the date
date0 <- unlist(strsplit('today_is_friday_12-12-2014', split = '_'))[4]

# Which can then be formatted as a date object (until now it is a character string)
class(date0)
(date <- as.Date(date0, format = '%m-%d-%Y'))
class(date)
```

See also `?substr`, this can be handy to.

## Read and write data sets

## Writing a function

## Creating a map

# Excercise of today (submit by e-mail to me before 10 am the next day)

## Dataframe manipulation
<!--

This section is also just a draft and should be further elaborated
-->
One central object class of R is the dataframes. The spatial vector classes of R are usually built around dataframes as well, as a consequence, all dataframe manipulation functions and methods are also highly relevant when dealing with spatial vector data in R.

* `str()`
* `subset()`
* `cbind()`, `rbind()`
* Methods with `[,]`, `[,] <-`
* `merge()`


# References

- [Rstudio Online Learning](http://www.rstudio.com/resources/training/online-learning/). 
